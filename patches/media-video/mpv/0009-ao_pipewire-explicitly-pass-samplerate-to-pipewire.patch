From 99c1f415de2a41eca47c6fb28f1db68235d35f35 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Thomas=20Wei=C3=9Fschuh?= <thomas@t-8ch.de>
Date: Thu, 16 Dec 2021 23:20:36 +0100
Subject: [PATCH 09/11] ao_pipewire: explicitly pass samplerate to pipewire

---
 audio/out/ao_pipewire.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/audio/out/ao_pipewire.c b/audio/out/ao_pipewire.c
index 9d2b3a7423..ca887514c7 100644
--- a/audio/out/ao_pipewire.c
+++ b/audio/out/ao_pipewire.c
@@ -200,6 +200,7 @@ static int init(struct ao *ao)
     struct spa_pod_builder b = SPA_POD_BUILDER_INIT(buffer, sizeof(buffer));
     const struct spa_pod *params[1];
     char latency_str[64];
+    char samplerate_str[8];
 
     enum spa_audio_format spa_format = af_fmt_to_pw(ao->format);
     if (spa_format == SPA_AUDIO_FORMAT_UNKNOWN) {
@@ -228,6 +229,7 @@ static int init(struct ao *ao)
 
     ao->device_buffer = p->buffer_samples;
     snprintf(latency_str, sizeof(latency_str), "%d/%d", ao->device_buffer, ao->samplerate);
+    snprintf(samplerate_str, sizeof(samplerate_str), "1/%d", ao->samplerate);
 
     pw_init(NULL, NULL);
 
@@ -247,6 +249,7 @@ static int init(struct ao *ao)
                         PW_KEY_APP_ID, ao->client_name,
                         PW_KEY_APP_ICON_NAME, ao->client_name,
                         PW_KEY_NODE_LATENCY, latency_str,
+                        PW_KEY_NODE_RATE, samplerate_str,
                         NULL),
                     &stream_events,
                     ao);
-- 
2.34.1

